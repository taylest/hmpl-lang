!function(e,t){"object"==typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.hmpl=e.hmpl||t()}("undefined"!=typeof self?self:this,(function(){return function(){"use strict";const e=e=>"object"==typeof e&&!Array.isArray(e)&&null!==e,t=e=>"[object Function]"===Object.prototype.toString.call(e),o=e=>{throw new Error(e)},n=e=>{console.warn(e)},r="method",s="initId",i="after",l="repeat",d="memo",c="indicators",a="autoBody",p="hmpl",f="formData",h="allowedContentTypes",u="get",m="BadResponseError",y="RequestInitError",g="RenderError",$="RequestObjectError",b="CompileOptionsError",v="ParseError",w="CompileError",T={formData:!0},N={formData:!1},E=/(\{\{(?:.|\n|\r)*?\}\}|\{\s*\{(?:.|\n|\r)*?\}\s*\})/g,P=/([{}])|([^{}]+)/g,O=["src",r,s,i,l,c,d,a,h],j=[100,101,102,103,300,301,302,303,304,305,306,307,308,400,401,402,403,404,405,406,407,408,409,410,411,412,413,414,415,416,417,418,421,422,423,424,425,426,428,429,431,451,500,501,502,503,504,505,506,507,508,510,511],k=["text/html"],x=e=>(new DOMParser).parseFromString(`<template>${e}</template>`,"text/html").childNodes[0].childNodes[0].firstChild,C=(t,r,s,i,l,d,c,a,p={},f,h,u,g)=>{const{mode:$,cache:b,redirect:v,get:w,referrerPolicy:T,signal:N,credentials:E,timeout:P,referrer:O,headers:j,body:k,window:C,integrity:I}=p,A={method:i.toUpperCase()};void 0!==E&&(A.credentials=E),void 0!==k&&(A.body=k),void 0!==$&&(A.mode=$),void 0!==b&&(A.cache=b),void 0!==v&&(A.redirect=v),void 0!==T&&(A.referrerPolicy=T),void 0!==I&&(A.integrity=I),void 0!==O&&(A.referrer=O);const q=void 0!==N;if(q&&(A.signal=N),void 0!==C&&(A.window=C),void 0!==p.keepalive&&n(`${y}: The "keepalive" property is not yet supported`),j)if(e(j)){const e=new Headers;for(const t in j){const n=j[t],r=typeof n;"string"===r?e.set(t,n):o(`${y}: Expected type string, but received type ${r}`)}A.headers=e}else o(`${y}: The "headers" property must contain a value object`);P&&(q?n(`${y}: The "signal" property overwrote the AbortSignal from "timeout"`):A.signal=AbortSignal.timeout(P));const D=a&&!d&&s?.memo,B=e=>"rejected"===e||"number"==typeof e&&(e<200||e>299),R=e=>{c&&(u.response=e,w?.("response",e,u)),w?.("response",r)},S=(e,o=!0,n=!1)=>{if(d)f.response=e.cloneNode(!0),w?.("response",e);else{let r=[];const i=[...(o?e.cloneNode(!0):e).content.childNodes];if(s.nodes){const e=s.parentNode,t=[],o=s.nodes.length;for(let n=0;n<o;n++){const r=s.nodes[n];if(n===o-1)for(let o=0;o<i.length;o++){const n=i[o],s=e.insertBefore(n,r);t.push(s)}e.removeChild(r)}r=t.slice(),s.nodes=t}else{const e=t.parentNode,o=[],n=i.length;for(let r=0;r<n;r++){const n=i[r],s=e.insertBefore(n,t);o.push(s)}e.removeChild(t),r=o.slice(),s.nodes=o,s.parentNode=e}D&&n&&(s.memo.nodes=s.nodes,s.memo.isPending&&(s.memo.isPending=!1)),R(r)}};let F=!1;const M=()=>{if(d)f.response=void 0,w?.("response",void 0);else if(s?.nodes){const e=s.parentNode,t=s.nodes.length;for(let o=0;o<t;o++){const n=s.nodes[o];o===t-1&&e.insertBefore(s.comment,n),e.removeChild(n)}s.nodes=null,s.parentNode=null,c&&(u.response=void 0,w?.("response",void 0,u)),w?.("response",r)}D&&null!==s.memo.response&&(s.memo.response=null,delete s.memo.isPending,delete s.memo.nodes)},L=e=>{c?u.status!==e&&(u.status=e,w?.("status",e,u)):f.status!==e&&(f.status=e,w?.("status",e)),D&&B(e)&&(s.memo.response=null,delete s.memo.nodes),(e=>{if(g)if(D&&"pending"!==e&&B(e)&&s.memo.isPending&&(s.memo.isPending=!1),"pending"===e){const e=g.pending;void 0!==e&&(D&&(s.memo.isPending=!0),S(e))}else if("rejected"===e){const e=g.rejected;if(void 0!==e)S(e);else{const e=g.error;void 0!==e?S(e):M()}}else{const t=g[`${e}`];if(e>399)if(void 0!==t)S(t);else{const e=g.error;void 0!==e?S(e):M()}else(e<200||e>299)&&(F=!0,void 0!==t?S(t):M())}})(e)};let z=200;L("pending");let H=!0,U=!0;fetch(l,A).then((e=>{if(H=!1,z=e.status,L(z),e.ok||(g&&(U=!1),o(`${m}: Response with status code ${z}`)),Array.isArray(h)&&0!==h.length){const t=e.headers.get("Content-Type");((e,t)=>{if(!e)return!0;let o=!1;for(let n=0;n<t.length;n++){const r=t[n];if(e.includes(r)){o=!0;break}}return!o})(t,h)&&o(`${m}: Expected ${h.map((e=>`"${e}"`)).join(", ")}, but received "${t}"`)}return e.text()})).then((e=>{if(!F){if(D){const{response:t}=s.memo;if(null===t)s.memo.response=e;else{if(t===e)return void(()=>{if(s.memo.isPending){const e=s.parentNode,t=s.memo.nodes,o=s.nodes,n=o.length,r=[];for(let s=0;s<n;s++){const i=o[s];if(s===n-1)for(let o=0;o<t.length;o++){const n=t[o],s=e.insertBefore(n,i);r.push(s)}e.removeChild(i)}s.nodes=r.slice(),s.memo.isPending=!1,s.memo.nodes=r.slice()}const e=s.nodes.slice();R(e)})();s.memo.response=e,delete s.memo.nodes}}const o=(e=>{const t=x(e),o=t.content,n=o.querySelectorAll("script");for(let e=0;e<n.length;e++){const t=n[e];o.removeChild(t)}return t})(e);if(d)f.response=o,w?.("response",o);else{const e=[],n=[...o.content.childNodes];if(s)S(o,!1,!0);else{const o=t.parentNode;for(let r=0;r<n.length;r++){const s=n[r],i=o.insertBefore(s,t);c&&e.push(i)}o.removeChild(t),c&&(u.response=e,w?.("response",e,u)),w?.("response",r)}}}})).catch((e=>{throw H?(L("rejected"),g||M()):U&&M(),e}))},I=(e,t=!1)=>{const n=t?b:$;"*"===e||((e,t)=>{if(!Array.isArray(e))return!1;let n=!0;for(let r=0;r<e.length;r++)if("string"!=typeof e[r]){o(`${t}: In the array, the element with index ${r} is not a string`),n=!1;break}return n})(e,n)||o(`${n}: Expected "*" or string array, but got neither`)},A=(t,n=!1)=>{const r=e(t),s=n?b:$;if("boolean"==typeof t||r||o(`${s}: Expected a boolean or object, but got neither`),r)for(const e in t)if(e===f)"boolean"!=typeof t[f]&&o(`${s}: The "${f}" property should be a boolean`);else o(`${s}: Unexpected property "${e}"`)},q=e=>{e.hasOwnProperty("id")&&e.hasOwnProperty("value")||o(`${y}: Missing "id" or "value" property`)};return{compile:(n,f={})=>{"string"!=typeof n&&o(`${w}: Template was not found or the type of the passed value is not string`),n||o(`${w}: Template must not be a falsey value`),e(f)||o(`${b}: Options must be an object`);const m=!f.hasOwnProperty(d);m||"boolean"==typeof f[d]||o(`${b}: The value of the property ${d} must be a boolean value`);const D=!f.hasOwnProperty(a);D||A(f[a],!0);const B=!f.hasOwnProperty(h);B||I(f[h],!0);const R=[],S=n.split(E).filter(Boolean),F=[];for(const e of n.matchAll(E))F.push(e.index);0===F.length&&o(`${v}: Request object not found`);const M=e=>e=(e=e.trim()).replace(/\r?\n|\r/g,""),L=(e,t)=>{const n=JSON5.parse(e);for(const e in n){const t=n[e];switch(O.includes(e)||o(`${$}: Property "${e}" is not processed`),e){case c:Array.isArray(t)||o(`${$}: The value of the property "${e}" must be an array`);break;case s:"string"!=typeof t&&"number"!=typeof t&&o(`${$}: The value of the property "${e}" must be a string`);break;case d:case l:"boolean"!=typeof t&&o(`${$}: The value of the property "${e}" must be a boolean value`);break;case a:A(t);break;case h:I(t);break;default:"string"!=typeof t&&o(`${$}: The value of the property "${e}" must be a string`)}}const r={...n,arrId:t};R.push(r)};let z=0;for(let e=0;e<S.length;e++){const t=S[e];if(F.includes(z)){const n=t.split(P).filter(Boolean);let r=-1,s="",i=!0,l=!1;for(let d=0;d<n.length;d++){const c=n[d],a="}"===c;if("{"===c)i?(i=!1,"{"!==n[d+1]&&d++):s+=c,r++;else if(a){if(1===r&&(l=!0),0===r){L(s,e),r--,z+=t.length;break}r--,s+=c}else l?M(c)&&o(`${v}: There is no empty space between the curly brackets`):s+=c}if(-1!==r){const n=e+1,i=S[n],d=i.split(P).filter(Boolean);let c="";for(let a=0;a<d.length;a++){const p=d[a],f="{"===p;if("}"===p){if(1===r&&(l=!0),0===r){const o=[...d];z+=t.length+i.length,o.splice(0,a+1),S[n]=o.join(""),L(s+c,e),r--,e++;break}r--,c+=p}else f?(c+=p,r++):l?M(p)&&o(`${v}: There is no empty space between the curly brackets`):c+=p}}}else z+=t.length}for(let e=0;e<R.length;e++){const t=R[e],{arrId:o}=t,n=`\x3c!--hmpl${e}--\x3e`;S[o]=n,delete t.arrId}n=S.join("");let H=!1;const U=(e=>{const t=x(e.trim());(t.content.childNodes.length>1||1!==t.content.children.length&&8!==t.content.childNodes[0].nodeType)&&o(`${g}: Template includes only one node of the Element type or one response object`);const n=e=>{switch(e.nodeType){case Node.ELEMENT_NODE:if("PRE"===e.tagName)return;break;case Node.TEXT_NODE:if(!/\S/.test(e.textContent))return void e.remove()}for(let t=0;t<e.childNodes.length;t++)n(e.childNodes.item(t))};n(t.content.childNodes[0]);let r=t.content.firstElementChild;if(!r){const e=t.content.firstChild;8===e?.nodeType&&(H=!0,r=e)}return r})(n);return((n,s,c,f,u,m,b,w=!1)=>{const E=(n,s)=>{const c=n.src;if(c){const p=(n.method||"GET").toLowerCase();if(!(e=>"get"!==e&&"post"!==e&&"put"!==e&&"delete"!==e&&"patch"!==e)(p)){const r=n.after;r&&w&&o(`${g}: EventTarget is undefined`);const v=!n.hasOwnProperty(l),E="all"==(v||n.repeat?"all":"one"),P=!n.hasOwnProperty(d);let O=!u&&f.memo;P?O&&(r&&E||(O=!1)):r?n.memo?E?O=!0:o(`${$}: Memoization works in the enabled repetition mode`):O=!1:o(`${$}: Memoization works in the enabled repetition mode`);const q=!n.hasOwnProperty(a);let D=!m&&f.autoBody;if(q)!0===D&&(D=T),r||(D=!1);else if(r){let e=n[a];if(A(e),!0===D&&(D=T),!0===e&&(e=T),!1===e)D=!1;else{const t={...!1===D?N:D,...e};D=t}}else D=!1,o(`${$}: The "${a}" property does not work without the "${i}" property`);const B=!n.hasOwnProperty(h);let R=b?k:f.allowedContentTypes;if(!B){const e=n[h];I(e),R=e}const S=n.initId,F=n.nodeId;let M=n.indicators;if(M){const e=e=>{const{trigger:t,content:n}=e;t||o(`${$}: Failed to activate or detect the indicator`),n||o(`${$}: Failed to activate or detect the indicator`),-1===j.indexOf(t)&&"pending"!==t&&"rejected"!==t&&"error"!==t&&o(`${$}: Failed to activate or detect the indicator`);const r=x(n);return{...e,content:r}},t={},n=[];for(let r=0;r<M.length;r++){const s=e(M[r]),{trigger:i}=s;-1===n.indexOf(i)?n.push(i):o(`${$}: Indicator trigger must be unique`),t[`${i}`]=s.content}M=t}const L=(e,t=!1)=>{if(t){if(S){let t;for(let o=0;o<e.length;o++){const n=e[o];if(n.id===S){t=n.value;break}}return t||o(`${$}: ID referenced by request not found`),t}return{}}return S&&o(`${$}: ID referenced by request not found`),e},z=E&&r,H=(n,r,i,l,d,a=!1,f,h=!1,u,m)=>{const g=l.currentId;if(w)n||(n=s);else if(!n){let e;const{els:t}=l;for(let o=0;o<t.length;o++){const n=t[o];if(n.id===F){u=n,e=n.el;break}}n=e}let $;w||(z||M)&&($=u.objNode,$||($={id:g,nodes:null,parentNode:null,comment:n},O&&($.memo={response:null},M&&($.memo.isPending=!1)),u.objNode=$,l.dataObjects.push($),l.currentId++));let b=L(r,a);const v=t(b);if(!v&&b&&(b={...b}),D&&D.formData&&m&&!v){const{type:e,target:t}=m;"submit"===e&&t&&t instanceof HTMLFormElement&&"FORM"===t.nodeName&&(b.body=new FormData(t,m.submitter))}const T=v?((e,t)=>{const o={};return void 0!==t&&(o.event=t),e({request:o})})(b,m):b;e(T)||void 0===T||o(`${y}: Expected an object with initialization options`),C(n,d,$,p,c,w,h,O,T,i,R,f,M)};let U=H;if(r){const e=(e,t,n,r,s,i,l,d,c,a,p)=>{const f=c.querySelectorAll(n);0===f.length&&o(`${g}: Selectors nodes not found`);const h=E?t=>{H(e,r,s,i,c,l,a,d,p,t)}:o=>{H(e,r,s,i,c,l,a,d,p,o);for(let e=0;e<f.length;e++)f[e].removeEventListener(t,h)};for(let e=0;e<f.length;e++)f[e].addEventListener(t,h)};if(r.indexOf(":")>0){const t=r.split(":"),o=t[0],n=t.slice(1).join(":");U=(t,r,s,i,l,d=!1,c,a=!1,p)=>{e(t,o,n,r,s,i,d,a,l,c,p)}}else o(`${$}: The "${i}" property doesn't work without EventTargets`)}else v||o(`${$}: The "${l}" property doesn't work without "${i}" property`);return U}o(`${$}: The "${r}" property has only GET, POST, PUT, PATCH or DELETE values`)}else o(`${$}: The "src" property are not found or empty`)};let P;if(w)c[0].el=n,P=E(c[0]);else{let e=-2;const t=n=>{if(e++,8==n.nodeType){let t=n.nodeValue;if(t&&t.startsWith(p)){t=t.slice(4);const r=Number(t),s=c[r];(Number.isNaN(r)||void 0===s)&&o(`${v}: Request object with id "${r}" not found`),s.el=n,s.nodeId=e}}if(n.hasChildNodes()){const e=n.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};if(t(n),c.length>1){const e=[];for(let t=0;t<c.length;t++){const o=c[t];e.push(E(o,n))}P=(t,o,n,r,s,i=!1)=>{t||(t=s);const l=[],d=r.els;for(let s=0;s<d.length;s++){const c=d[s],a=c.el,p={response:void 0};(0,e[s])(a,o,n,r,t,i,p,!0,c),l.push(p)}n.requests=l}}else P=E(c[0],n)}return s(P)})(U,(n=>(r={})=>{const s=U.cloneNode(!0),i={response:H?void 0:s},l={dataObjects:[],els:[],currentId:0};if(!H){let e=-2;const t=o=>{if(e++,8==o.nodeType){const t=o.nodeValue;if(t&&t.startsWith(p)){const t={el:o,id:e};l.els.push(t)}}if(o.hasChildNodes()){const e=o.childNodes;for(let o=0;o<e.length;o++)t(e[o])}};t(s)}var d;return e(r)||t(r)?(e(d=r)&&d.hasOwnProperty(`${u}`)&&(t(d[u])||o(`${y}: The "${u}" property has a function value`)),n(void 0,r,i,l,s)):Array.isArray(r)?((t=>{const n=[];for(let r=0;r<t.length;r++){const s=t[r];e(s)||o(`${y}: IdentificationRequestInit is of type object`),q(s);const{id:i}=s,l="string"==typeof s.id;l||"number"==typeof s.id||o(`${y}: ID must be a string or a number`),n.indexOf(i)>-1?o(`${y}: ID with value ${l?`"${i}"`:i} already exists`):n.push(i)}})(r),n(void 0,r,i,l,s,!0)):o(`${y}: The type of the value being passed does not match the supported types for RequestInit`),i}),R,f,m,D,B,H)},stringify:e=>JSON5.stringify(e)}}()}));